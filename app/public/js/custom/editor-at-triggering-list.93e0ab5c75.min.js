class EditorCharTriggeringList{constructor(t,i,s=null){this._codemirror=t,this._doc=this._codemirror.doc,this._display=this._codemirror.display,this._cursor=this._display.cursor,this._wrapper=this._display.wrapper,this._itemsSet=i,this._list=null,this._items=null,this._activate=!1,this._isTriggered=!1,this._index=0,this._total=0,this._triggerCursor=null,this._limit=-1,this._triggerChar=null,this._listCssObj=null,this._itemCssObj=null,this._listClasses=null,this._itemClasses=null,this._configuration=s,this._parseConfig(),this._initList(),this._initListeners()}activate(){this._activate=!0,this._codemirror.on("change",this._onChange)}deactivate(){this._hide(),this._activate=!1,this._codemirror.off("change",this._onChange)}_parseConfig(){const t=this._configuration||{};this._limit=t.hasOwnProperty("limit")?t.limit:5,this._triggerChar=t.hasOwnProperty("triggerChar")?t.triggerChar:"@",this._listCssObj=t.hasOwnProperty("listCssObj")?t.listCssObj:null,this._itemCssObj=t.hasOwnProperty("itemCssObj")?t.itemCssObj:null,this._listClasses=t.hasOwnProperty("listClasses")?t.listClasses:null,this._itemClasses=t.hasOwnProperty("itemClasses")?t.itemClasses:null}_nextItem(){let t=this._index+1;t>this._total-1&&(t=0),this._selectItem(t)}_prevItem(){let t=this._index-1;t<0&&(t=this._total-1),this._selectItem(t)}_selectItem(t){const i=this._list.get(0).childNodes;$(i[this._index]).removeClass("trigger-item-active"),this._index=t,$(i[this._index]).addClass("trigger-item-active")}_enterItem(){const t=this._list.get(0).childNodes,i=$(t[this._index]).text();this._hide(),this._doc.replaceRange(`${i} `,this._triggerCursor,this._doc.getCursor()),this._codemirror.focus()}_initListeners(){this._onChange=this._onChange.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onHide=this._onHide.bind(this),this._onCursorActivity=this._onCursorActivity.bind(this)}_onChange(t,i){i.text.toString()==this._triggerChar&&(this._triggerCursor=this._doc.getCursor(),this._show())}_onCursorActivity(){const t=this._doc.getCursor();if(t.line>this._triggerCursor.line||t.line==this._triggerCursor.line&&t.ch>=this._triggerCursor.ch){const t=this._doc.getRange(this._triggerCursor,this._doc.getCursor());if(this._searchKeyword(t))return void this._updatePosition()}this._hide()}_onHide(){this._hide()}_onKeydown(t){switch(event.keyCode){case 13:case 38:case 40:event.preventDefault(),event.stopPropagation(),13==event.keyCode?this._enterItem():38==event.keyCode?this._prevItem():40==event.keyCode&&this._nextItem();break;case 27:this._hide()}}_searchKeyword(t){t=t.toLowerCase();const i=[],s=this._itemsSet.values();for(let e of s)-1!=e.toLowerCase().indexOf(t)&&i.length<this._limit&&i.push(e);if(this._list.empty(),i.length){i.sort((i,s)=>{return i.toLowerCase().indexOf(t)-s.toLowerCase().indexOf(t)});for(let s=0;s<i.length;s++){let e=this._items[s];e.removeClass("trigger-item-active");let r=new RegExp(`(${t})`,"gi"),o=i[s];o=o.replace(r,"<b>$1</b>"),e.html(o),this._list.append(e)}return this._total=i.length,this._selectItem(0),!0}return!1}_updatePosition(){const t=this._display.cachedTextHeight;this._list.css("left",$(this._cursor).css("left")),this._list.css("top",this._wrapper.offsetTop+this._cursor.offsetTop-this._doc.scrollTop+t/2)}_show(){this._isTriggered||($(this._wrapper.offsetParent).append(this._list),this._list.show(),this._isTriggered=!0,this._codemirror.on("keydown",this._onKeydown),this._codemirror.on("blur",this._onHide),this._codemirror.on("scroll",this._onHide),this._codemirror.on("cursorActivity",this._onCursorActivity))}_hide(){this._list.hide(),this._isTriggered=!1,this._codemirror.off("keydown",this._onKeydown),this._codemirror.off("blur",this._onHide),this._codemirror.off("scroll",this._onHide),this._codemirror.off("cursorActivity",this._onCursorActivity)}_initList(){this._list=$("<ul></ul>"),this._list.addClass("trigger-list"),this._list.mousedown(t=>{t.preventDefault(),t.stopPropagation()}),this._list.click(t=>{t.preventDefault(),t.stopPropagation();const i=t.target,s=this._list.get(0).childNodes;for(var e of s.entries())if(i==e[1]){this._selectItem(e[0]),this._enterItem();break}}),this._items=[];for(let t=0;t<this._limit;t++){let t=$("<li>unknown</li>");t.addClass("trigger-item"),this._items.push(t)}}}