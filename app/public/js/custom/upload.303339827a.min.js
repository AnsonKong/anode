const avatarMaxSize=1048576,cropMaxSize=400;let jcropApi;function uploadAvatar(){if($("input[type=file]")[0].files[0].size>avatarMaxSize)return $(".avatar-fail").show(),$(".avatar-fail").text("图片大小不得大于1MB。"),void $(".avatar-success").hide();const a=new FormData;a.append("image",$("input[type=file]")[0].files[0]),$.ajax({url:"/upload/avatar/validate?_csrf="+getCsrf(),data:a,method:"POST",contentType:!1,processData:!1,success:function(a,t,r){0==a.code?popupModal(a.data):($(".avatar-fail").show(),$(".avatar-fail").text(a.msg),$(".avatar-success").hide())},error:function(a){alert("error",a)}})}function popupModal(a){$("#myModal").modal({backdrop:"static"}),$("#myCrop").attr("src",a),$("#myCrop").Jcrop({boxWidth:cropMaxSize,boxHeight:cropMaxSize,bgColor:"white",bgOpacity:.5,aspectRatio:1},function(){jcropApi=this;const a=$("#myCrop")[0].width,t=$("#myCrop")[0].height;if(a!==t){const r=Math.min(a,t),o=.5*(a-r),e=.5*(t-r);jcropApi.setSelect([o,e,r,r])}})}function saveCrop(){const a={},t=jcropApi.tellSelect();a.avatarUrl=$("#myCrop").attr("src"),0!=t.w&&0!=t.h&&(a.resizeW=$("#myCrop")[0].width,a.resizeH=$("#myCrop")[0].height,a.cropX=t.x,a.cropY=t.y,a.cropW=t.w,a.cropH=t.h),$.ajax({url:"/upload/avatar/upload?_csrf="+getCsrf(),data:a,method:"POST",success:function(a){0==a.code?($(".my-avatar").attr("src",a.data),$(".avatar-fail").hide(),$(".avatar-success").show()):($(".avatar-fail").show(),$(".avatar-fail").text(a.msg),$(".avatar-success").hide()),$("#myModal").modal("hide")},error:function(a){alert("error",a)}})}